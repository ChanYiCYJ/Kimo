<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>新建 / 编辑文章</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Vditor -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor/dist/index.css">
  <link rel="stylesheet" href="/static/css/vditor.css">
  <link rel="stylesheet" href="/static/css/loading.css">

  <style>
    body {
      background: #f9fafb;
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased">

  <!-- ===== Header ===== -->
  <header
    class="sticky top-0 z-30
           bg-white/80 backdrop-blur
           border-b border-gray-100"
  >
    <div class="mx-auto max-w-8xl px-6">
      <div class="flex h-16 items-center justify-between">
     <!-- 左侧：标题 -->
        <div class="flex-1 flex items-center gap-4">


          {% if post %}
          <a
            href="/dashboard?type=manageArticle"
            class="mr-4 px-3 py-2 rounded-xl text-sm bg-white border border-gray-200 hover:bg-gray-100 transition"
          >
            返回
          </a>
          {% endif %}
        <!-- 左侧：标题 -->
        <div class="flex-1 flex items-center">



          {% if post %}
          <a
            href="/dashboard?type=manageArticle"
            class="mr-4 px-3 py-2 rounded-xl text-sm bg-white border border-gray-200 hover:bg-gray-100 transition"
          >
            返回
          </a>
          {% endif %}

          <input
            id="titleInput"
            placeholder="Page Title"
            class="ml-4 w-full max-w-3xl
                   bg-transparent
                   text-2xl tracking-tight
                   text-gray-900 placeholder-gray-400
                   focus:outline-none
                   transition"
          />
        </div>

        <!-- 右侧：按钮 -->
        <div class="flex items-center gap-3">
              <!-- ===== 新：纯 HTML/CSS 分段开关（Markdown / List） ===== -->
          <nav aria-label="编辑模式" class="inline-flex rounded-xl bg-white border border-gray-200 shadow-sm p-1">
            <button
               class="px-3 py-2 text-sm rounded-lg transition
                      {% if not is_list %}bg-white text-gray-900 font-medium shadow{% else %}text-gray-500 hover:bg-gray-50{% endif %}">
              Markdown
            </button>
            <button
               class="px-3 py-2 text-sm rounded-lg transition
                      {% if is_list %}bg-white text-gray-900 font-medium shadow{% else %}text-gray-500 hover:bg-gray-50{% endif %}">
              List
            </button>
          </nav>
          <!-- ===== 分段开关结束 ===== -->
          {% if post %}
            <button
              id="editBtn"
              class="px-5 py-2 rounded-xl
                     text-sm font-semibold
                     bg-black text-white
                     hover:bg-gray-900
                     active:scale-[0.98]
                     transition">
              编辑
            </button>
          {% else %}
            <button
              id="sendBtn"
              class="px-5 py-2 rounded-xl
                     text-sm font-semibold
                     bg-black text-white
                     hover:bg-gray-900
                     active:scale-[0.98]
                     transition">
              发布
            </button>
          {% endif %}
        </div>

      </div>
    </div>
  </header>

  <!-- ===== 主体 ===== -->
  <main class="mx-auto max-w-7xl px-4 py-2 h-[calc(100vh-64px)] flex flex-col">

    <div id="global-loading"
         class="fixed inset-0 z-[9999] flex items-center justify-center bg-white">
      <div class="w-8 h-8 border-4 border-gray-300 border-t-gray-700 rounded-full animate-spin"></div>
    </div>

    <!-- 编辑器区域 -->
    <section class="flex-1">

      <div
        id="vditor"
        class="h-full bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"
      ></div>
    </section>
<!-- Modal（保留原 modal） -->
  <div class="fixed inset-0 bg-black/40 flex items-center justify-center hidden"
       id="modal">
      <div class="bg-white rounded-xl w-80 p-6 text-center">
          <h3 class="font-semibold mb-3">提示</h3>
          <p class="text-gray-600 mb-4" id="modal-text"></p>
          <button class="px-4 py-2 bg-gray-200 rounded-lg"
                  onclick="closeModal()">
              我知道了
          </button>
    </div>
  </div>
  </main>

  <!-- ===== JS ===== -->

  <script src="/static/js/loading.js"></script>

  <!-- Vditor -->
  <script src="https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js"></script>

  {% if post %}
  <script src="/static/js/getEdit.js"></script>
  {% endif %}

  <script>
    const vditor = new Vditor('vditor', {
      height: '100%',
      placeholder: '在这里输入 Markdown 内容...',
      upload: {
        url: '/upload/image/vditor',
        fieldName: 'file',
        max: 5 * 1024 * 1024,
        accept: 'image/*',
      },
      toolbar: [
        'bold',
        'italic',
        'strike',
        'headings',
        'quote',
        'code',
        'inline-code',
        'list',
        'ordered-list',
        'link',
        'upload',
        'preview',
        'fullscreen'
      ],
      toolbarConfig: { pin: true },
      cache: { enable: false },
      after() {
        {% if post %}
        if (typeof POST_DATA !== 'undefined' && POST_DATA){
          vditor.setValue(POST_DATA.content || '');
          document.getElementById('titleInput').value = POST_DATA.title || '';
        }
        {% endif %}
      }
    });
  </script>
<script>
  function showModal(message) {
    document.getElementById('modal-text').innerText = message
    document.getElementById('modal').classList.remove('hidden')
  }

  function closeModal() {
    document.getElementById('modal').classList.add('hidden')
  }
  </script>
  <script>
    const toggle = document.getElementById('CategoryConditions')

    toggle.addEventListener('change', (e) => {
      if (e.target.checked) {
        document.getElementById('CategoryList').classList.remove('hidden')
      } else {
        document.getElementById('CategoryList').classList.add('hidden')
      }
    })
  </script>
  <script>
const buttons = document.querySelectorAll(".mode-btn");

buttons.forEach(btn => {
  btn.addEventListener("click", () => {
    buttons.forEach(b => b.classList.remove("bg-white","shadow","text-gray-900","font-medium"));
    btn.classList.add("bg-white","shadow","text-gray-900","font-medium");

    const view = btn.dataset.view;
    console.log("当前模式：", view);

    // 你可以在这里控制显示区域
    document.getElementById("markdownBox").style.display = view === "markdown" ? "block" : "none";
    document.getElementById("listBox").style.display = view === "list" ? "block" : "none";
  });
});
</script>

  <!-- 发布 / 编辑逻辑 -->
  <script src="/static/js/createPage.js"></script>

</body>
</html>
