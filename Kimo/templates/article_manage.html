{% extends "layout.html" %}

{% block header %}
<header class="sticky top-0 z-30 bg-white/80 backdrop-blur
               border-b border-gray-100">
  <div class="mx-auto max-w-6xl px-4 sm:px-6 h-14
              flex items-center justify-between">

    <!-- å·¦ -->
    <div class="flex items-center gap-2 text-sm text-gray-700">
      <span class="opacity-70">ğŸ“„</span>
      <span class="font-medium">æ–‡ç« </span>
    </div>
    <a
          href="/editor"
          class="px-6 py-2 m-2 rounded-2xl
                 text-sm
                 bg-white border text-black
                 active:scale-[0.98]
                 transition"
        >
          æ–°å»ºæ–‡ç« 
</a>
  </div>
</header>
{% endblock %}

{% block content %}
<div class="col-span-1 md:col-span-2 space-y-6">
<div class="min-h-screen rounded-3xl  bg-white/80 backdrop-blur">

  <main class="mx-auto max-w-6xl px-4 sm:px-6 py-6">

    <!-- ç­›é€‰ -->
    <div class="flex items-center gap-3 text-sm mb-5">
      <button
        class="px-3 py-1.5 rounded-full
               bg-gray-900 text-white">
        å…¨éƒ¨
      </button>
    </div>

    <!-- åˆ—è¡¨ -->
    <section class="space-y-4">

  {% if post %}
  {% for article in post %}
  <article
    class="group bg-white
           rounded-3xl
           border border-gray-100
           hover:border-gray-200 hover:bg-gray-50
           transition"
  >

    <!-- ä¸»ä½“å¸ƒå±€ -->
    <div class="flex flex-col md:flex-row gap-4 md:gap-6 p-4 sm:p-6">

      <!-- å°é¢ -->
      {% if article.cover_image %}
      <div
        class="w-full
               md:w-56 md:flex-shrink-0
               aspect-[16/9]
               md:aspect-auto
               md:h-36
               rounded-2xl overflow-hidden
               bg-gray-100"
      >
        <img
          src="{{ article.cover_image }}"
          alt="{{ article.title }}"
          class="w-full h-full object-cover
                 transition-transform duration-300
                 md:group-hover:scale-105"
        />
      </div>
      {% endif %}

      <!-- å†…å®¹åŒº -->
      <div class="min-w-0 flex-1 flex flex-col justify-between">

        <div class="space-y-2 sm:space-y-3">

          <!-- æ ‡é¢˜ -->
          <h2
            class="text-sm sm:text-base
                   font-semibold text-gray-900
                   line-clamp-2 md:truncate"
          >
            {{ article.title }}
          </h2>

          <!-- æè¿° -->
          {% if article.description %}
          <p
            class="text-sm text-gray-500
                   leading-relaxed
                   line-clamp-2 md:line-clamp-1"
          >
            {{ article.description }}
          </p>
          {% endif %}

          <!-- å…ƒä¿¡æ¯ -->
          <div class="flex items-center gap-2 text-xs text-gray-400">
            {% if article.category_name %}
              <span>{{ article.category_name }}</span>
              <span class="opacity-40">Â·</span>
            {% endif %}
            <span>{{ article.created }}</span>
          </div>

        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div
          class="mt-3 flex items-center gap-2 text-sm
                 opacity-100 translate-y-0
                 md:opacity-0 md:translate-y-1
                 md:group-hover:opacity-100
                 md:group-hover:translate-y-0
                 transition-all duration-150"
        >
          <a
            href="/editor/{{ article.id }}"
            class="px-3 py-1.5 rounded-full
                   text-gray-600
                   hover:bg-gray-200/60"
          >
            ç¼–è¾‘
          </a>

          <button
            data-id="{{ article.id }}"
            class="delete-btn
                   px-3 py-1.5 rounded-full
                   text-red-500
                   hover:bg-red-100/60"
          >
            åˆ é™¤
          </button>
        </div>

      </div>

    </div>
  </article>
  {% endfor %}

      {% else %}
        <div class="py-24 text-center text-sm text-gray-400">
          è¿˜æ²¡æœ‰æ–‡ç« ï¼Œç‚¹å‡»å³ä¸Šè§’ã€Œæ–°å»ºã€å¼€å§‹å†™ä½œ âœï¸
        </div>
      {% endif %}

    </section>

  </main>
</div>
</div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block script %}
<script>
document.addEventListener('click', function (e) {
  const btn = e.target.closest('.delete-btn');
  if (!btn) return;

  const post_id = btn.dataset.id;
  if (!post_id) return;

  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ')) return;

  fetch('/article/delete', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ post_id })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status) {
      location.reload();
    } else {
      alert(data.message || 'åˆ é™¤å¤±è´¥');
    }
  })
  .catch(err => {
    console.error(err);
    alert('è¯·æ±‚å¤±è´¥');
  });
});
</script>
{% endblock %}
